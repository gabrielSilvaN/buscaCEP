<html lang="pt-br">

<head>
	<meta charset="utf-8">
	<title>App Pesquisa Endereço</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
		integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

		<script>

function buscarCEP(cep) {					
	
	//Definindo o objeto XMLHttpRequest
	let ajax = new XMLHttpRequest()

	//Neste projeto utilizei o ViaCEP. Endereço web da API: https://viacep.com.br/

	//Url para a API do ViaCEP
	let url = 'http://viacep.com.br/ws/'+cep+'/json/unicode/' 			

	ajax.open('GET', url)

	ajax.onreadystatechange = function () {

		if(document.getElementById('mensagem')){
			document.getElementById('mensagem').remove()
		}

		//Em caso de sucesso
		if (ajax.status == 200 && ajax.readyState == 4) {

			let json = JSON.parse(ajax.responseText)				

			if(json['erro'] == true){

				document.getElementById('endereco').className = 'form-control bg-danger'			
				document.getElementById('bairro').className = 'form-control bg-danger'
				document.getElementById('cidade').className = 'form-control bg-danger'
				document.getElementById('uf').className = 'form-control bg-danger'

				var div = document.createElement('div')
				var p = document.createElement('p')

				div.className = 'alert alert-danger alert-dismissible fade show'
				div.id = 'mensagem'		
				p.innerHTML = 'CEP não encontrado na base de dados!'

				div.appendChild(p)

				var divPrincipal = document.getElementById('corpo')
				divPrincipal.appendChild(div)

			}else{

				document.getElementById('endereco').value = json.logradouro
				document.getElementById('bairro').value = json.bairro
				document.getElementById('cidade').value = json.localidade
				document.getElementById('uf').value = json.uf
				
			}

		} else if(ajax.status != 200 && ajax.readyState == 4){		
			

			document.getElementById('endereco').className = 'form-control bg-danger'			
			document.getElementById('bairro').className = 'form-control bg-danger'
			document.getElementById('cidade').className = 'form-control bg-danger'
			document.getElementById('uf').className = 'form-control bg-danger'		
			

			var div = document.createElement('div')
			var p = document.createElement('p')

			div.className = 'alert alert-danger alert-dismissible fade show'
			div.id = 'mensagem'		
			p.innerHTML = 'CEP com formato inválido!'

			div.appendChild(p)

			var divPrincipal = document.getElementById('corpo')
			divPrincipal.appendChild(div)		

		}
	}

	ajax.send()	

}

</script>

</head>

<body >

	<nav class="navbar navbar-light bg-light mb-4">
		<div class="container">
			<div class="navbar-brand mb-0 h1">
				<h3>App Pesquisa Endereço</h3>
			</div>
		</div>
	</nav>

	<div class="container" id='corpo'>
		<div class="row form-group">
			<div class="col-sm-3">
				<input onblur="buscarCEP(this.value)" type="text" class="form-control" placeholder="CEP" id="CEP" />
			</div>
			<div class="col-sm-9">
				<input type="text" class="form-control" placeholder="Endereço" readonly id="endereco" />
			</div>
		</div>

		<div class="row form-group">
			<div class="col-sm-6">
				<input type="text" class="form-control" placeholder="Bairro" id="bairro" readonly />
			</div>
			<div class="col-sm-4">
				<input type="text" class="form-control" placeholder="Cidade" id="cidade" readonly />
			</div>

			<div class="col-sm-2">
				<input type="text" class="form-control" placeholder="UF" id="uf" readonly />
			</div>
		</div>
	</div>
</body>

</html>